<div class="flex flex-col h-[calc(100vh-130px)] overflow-hidden space-y-0">

  <!-- Encabezado con botón regresar (fijo) -->
  <div class="sticky-title" [class.scrolled]="hasScrolled">
    <div class="flex items-center gap-2 py-1">
      <button
        class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-medium text-slate-600 shadow-sm hover:bg-slate-50 hover:text-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-200 focus:ring-offset-1"
        (click)="goBack()">
        <span class="text-[14px] leading-none">‹</span>
        <span>Regresar al listado</span>
      </button>
    </div>
  </div>

  <!-- Contenido con scroll -->
  <div class="flex-1 overflow-y-auto pr-1 space-y-5">

    <!-- Estado cargando -->
    <div *ngIf="isLoading"
      class="flex items-center gap-3 rounded-xl border border-sky-100 bg-sky-50 px-4 py-3 text-xs text-sky-800">
      <span class="h-4 w-4 animate-spin rounded-full border border-sky-300 border-t-transparent"></span>
      <span>Cargando información del producto…</span>
    </div>

    <!-- Estado error -->
    <div *ngIf="errorMessage"
      class="flex items-start gap-3 rounded-xl border border-red-100 bg-red-50 px-4 py-3 text-xs text-red-800">
      <span class="mt-0.5 h-2 w-2 rounded-full bg-red-400"></span>
      <div>
        <p class="font-semibold">Ocurrió un problema</p>
        <p class="mt-0.5 text-[11px]">{{ errorMessage }}</p>
      </div>
    </div>

    <!-- Detalle del producto -->
    <div *ngIf="!isLoading && product"
      class="rounded-2xl border border-slate-200 bg-white p-5 shadow-[0_10px_40px_rgba(15,23,42,0.10)]">
      <div class="flex flex-col gap-6 lg:flex-row">

        <!-- Imagen / placeholder -->
        <div class="w-full lg:w-1/3">
          <div class="relative overflow-hidden rounded-2xl bg-slate-100 aspect-[4/3]">
            <img *ngIf="product.imageUrl; else placeholderImage"
                 [src]="product.imageUrl"
                 [alt]="product.name"
                 class="h-full w-full object-cover transition-transform duration-300 hover:scale-105" />
            <ng-template #placeholderImage>
              <div class="flex h-full w-full flex-col items-center justify-center gap-1 text-[11px] text-slate-400">
                <span class="h-9 w-9 rounded-full border border-dashed border-slate-300"></span>
                <span>Sin imagen disponible</span>
              </div>
            </ng-template>

            <!-- Precio sobre la imagen -->
            <div
              class="absolute bottom-3 right-3 rounded-full bg-emerald-50/95 px-3 py-1 text-[11px] font-semibold text-emerald-700 shadow-sm">
              {{ product.precioUnitario | currency:'COP':'symbol-narrow':'1.0-0' }}
            </div>
          </div>

          <!-- Inventario resumido -->
          <div *ngIf="inventory" class="mt-3 flex items-center justify-between text-[11px]">
            <span class="text-slate-500 uppercase tracking-[0.16em]">
              INVENTARIO
            </span>
            <span
              class="inline-flex items-center gap-1 rounded-full bg-slate-50 px-3 py-1 text-[11px] font-medium text-slate-700">
              <span class="h-1.5 w-1.5 rounded-full"
                [ngClass]="inventory.availableQuantity > 0 ? 'bg-emerald-400' : 'bg-red-400'"></span>
              {{ inventory.cantidadNueva }} disponibles
            </span>
          </div>
        </div>

        <!-- Información y compra -->
        <div class="w-full lg:w-2/3 flex flex-col justify-between gap-4">
          <!-- Info principal -->
          <div>
            <div class="flex flex-wrap items-center justify-between gap-2">
              <h2 class="text-lg font-semibold text-slate-900">
                {{ product.nombreProducto }}
              </h2>
              <div
                class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-500 to-indigo-600 px-3 py-1 text-[11px] font-medium text-white shadow-sm">
                <span class="h-1.5 w-1.5 rounded-full bg-emerald-300"></span>
                <span>Producto activo</span>
              </div>
            </div>

            <p class="mt-2 text-[13px] leading-relaxed text-slate-600">
              {{ producto.descripcion || 'Este producto no tiene una descripción registrada aún.' }}
            </p>
          </div>

          <!-- Sección de compra -->
          <div class="mt-2 rounded-2xl border border-slate-100 bg-slate-50/60 p-4">
            <div class="flex flex-wrap items-start justify-between gap-4">
              <!-- Precio destacado -->
              <div>
                <span class="text-[10px] uppercase tracking-[0.14em] text-slate-400">
                  Precio unitario
                </span>
                <p class="text-xl font-semibold text-emerald-700">
                  {{ product.precioUnitario | currency:'COP':'symbol-narrow':'1.0-0' }}
                </p>
              </div>

              <!-- Cantidad y acción -->
              <div class="flex flex-1 flex-col items-stretch gap-2 sm:flex-row sm:items-end">
                <div class="flex-1">
                  <label class="block text-[11px] font-medium text-slate-600 mb-1">
                    Cantidad a comprar
                  </label>
                  <div class="relative">
                    <input type="number" [(ngModel)]="quantity" min="1"
                      class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-800 shadow-sm outline-none hover:border-sky-300 focus:border-sky-400 focus:ring-2 focus:ring-sky-100" />
                    <span
                      class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-[11px] text-slate-400">
                      unid.
                    </span>
                  </div>
                </div>

                <button
                  class="inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-sky-500 to-indigo-600 px-4 py-2.5 text-[12px] font-medium text-white shadow-sm hover:from-sky-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-sky-300 focus:ring-offset-1 disabled:opacity-60 disabled:cursor-not-allowed"
                  (click)="purchase()" [disabled]="isUpdating || quantity < 1">
                  <span *ngIf="!isUpdating">Comprar ahora</span>
                  <span *ngIf="isUpdating">Procesando…</span>
                </button>
              </div>
            </div>

            <!-- Mensaje de éxito -->
            <div *ngIf="successMessage"
              class="mt-3 flex items-start gap-2 rounded-xl border border-emerald-100 bg-emerald-50 px-3 py-2 text-[11px] text-emerald-800">
              <span class="mt-0.5 h-2 w-2 rounded-full bg-emerald-400"></span>
              <p>{{ successMessage }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
