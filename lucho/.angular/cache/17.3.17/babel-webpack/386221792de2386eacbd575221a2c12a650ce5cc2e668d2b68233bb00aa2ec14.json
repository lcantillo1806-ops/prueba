{"ast":null,"code":"import { inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ActivatedRoute } from '@angular/router';\nimport { ProductService } from '../../services/product.service';\nimport { InventoryService } from '../../services/inventory.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nfunction ProductDetailComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Cargando...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductDetailComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.errorMessage);\n  }\n}\nfunction ProductDetailComponent_div_2_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Cantidad disponible: \", ctx_r0.inventory.availableQuantity, \"\");\n  }\n}\nfunction ProductDetailComponent_div_2_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.successMessage, \" \");\n  }\n}\nfunction ProductDetailComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"h2\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, ProductDetailComponent_div_2_div_8_Template, 3, 1, \"div\", 0);\n    i0.ɵɵelementStart(9, \"div\", 3)(10, \"label\");\n    i0.ɵɵtext(11, \" Cantidad a comprar: \");\n    i0.ɵɵelementStart(12, \"input\", 4);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ProductDetailComponent_div_2_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r0.quantity, $event) || (ctx_r0.quantity = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ProductDetailComponent_div_2_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.purchase());\n    });\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(15, ProductDetailComponent_div_2_div_15_Template, 2, 1, \"div\", 6);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.product.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.product.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Precio: \", i0.ɵɵpipeBind2(7, 8, ctx_r0.product.price, \"COP\"), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.inventory);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r0.quantity);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.isUpdating);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.isUpdating ? \"Procesando...\" : \"Comprar\", \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.successMessage);\n  }\n}\nexport let ProductDetailComponent = /*#__PURE__*/(() => {\n  class ProductDetailComponent {\n    constructor() {\n      this.route = inject(ActivatedRoute);\n      this.productService = inject(ProductService);\n      this.inventoryService = inject(InventoryService);\n      this.isLoading = false;\n      this.isUpdating = false;\n      this.errorMessage = '';\n      this.successMessage = '';\n      this.quantity = 1;\n    }\n    ngOnInit() {\n      const id = this.route.snapshot.paramMap.get('id');\n      if (id) {\n        this.loadData(id);\n      } else {\n        this.errorMessage = 'Producto inválido.';\n      }\n    }\n    loadData(productId) {\n      this.isLoading = true;\n      this.errorMessage = '';\n      this.productService.getProductById(productId).subscribe({\n        next: product => {\n          this.product = product;\n          this.loadInventory(product.id);\n        },\n        error: () => {\n          this.errorMessage = 'No se pudo cargar la información del producto.';\n          this.isLoading = false;\n        }\n      });\n    }\n    loadInventory(productId) {\n      this.inventoryService.getInventory(productId).subscribe({\n        next: inventory => {\n          this.inventory = inventory;\n          this.isLoading = false;\n        },\n        error: () => {\n          this.errorMessage = 'Error al cargar el inventario.';\n          this.isLoading = false;\n        }\n      });\n    }\n    purchase() {\n      if (!this.product || !this.inventory) return;\n      if (this.quantity <= 0) return;\n      this.isUpdating = true;\n      this.errorMessage = '';\n      this.successMessage = '';\n      this.inventoryService.updateAfterPurchase(this.product.id, this.quantity).subscribe({\n        next: updated => {\n          this.inventory = updated;\n          this.isUpdating = false;\n          this.successMessage = 'Compra realizada y stock actualizado.';\n        },\n        error: () => {\n          this.isUpdating = false;\n          this.errorMessage = 'No se pudo completar la compra.';\n        }\n      });\n    }\n    static {\n      this.ɵfac = function ProductDetailComponent_Factory(t) {\n        return new (t || ProductDetailComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProductDetailComponent,\n        selectors: [[\"app-product-detail\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 3,\n        vars: 3,\n        consts: [[4, \"ngIf\"], [\"class\", \"error\", 4, \"ngIf\"], [1, \"error\"], [1, \"purchase\"], [\"type\", \"number\", \"min\", \"1\", 3, \"ngModelChange\", \"ngModel\"], [3, \"click\", \"disabled\"], [\"class\", \"success\", 4, \"ngIf\"], [1, \"success\"]],\n        template: function ProductDetailComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, ProductDetailComponent_div_0_Template, 2, 0, \"div\", 0)(1, ProductDetailComponent_div_1_Template, 2, 1, \"div\", 1)(2, ProductDetailComponent_div_2_Template, 16, 11, \"div\", 0);\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.isLoading && ctx.product);\n          }\n        },\n        dependencies: [CommonModule, i1.NgIf, i1.CurrencyPipe, FormsModule, i2.DefaultValueAccessor, i2.NumberValueAccessor, i2.NgControlStatus, i2.MinValidator, i2.NgModel],\n        encapsulation: 2\n      });\n    }\n  }\n  return ProductDetailComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}