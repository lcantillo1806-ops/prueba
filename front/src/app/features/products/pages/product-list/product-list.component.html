<div class="product-list space-y-5">

  <!-- Encabezado fijo del catálogo -->
  <div class="sticky-title" [class.scrolled]="hasScrolled">
    <div class="flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between py-1">
      <div>
        <h2 class="text-lg font-semibold text-slate-900 leading-tight">
          Catálogo de productos
        </h2>
        <p class="text-xs text-slate-500">
          Consulta rápida de productos, precios y detalles.
        </p>
      </div>

      <div
        class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-500 to-indigo-600 px-4 py-1 shadow-sm">
        <span class="h-2 w-2 rounded-full bg-emerald-300 shadow-sm"></span>
        <span class="text-xs font-medium text-white">
          {{ totalItems || products.length }} productos disponibles
        </span>
      </div>
    </div>
  </div>

  <!-- Contenido (ya NO tiene scroll propio) -->
  <div class="space-y-4 pt-1">

    <!-- Cargando -->
    <div *ngIf="isLoading"
      class="flex items-center gap-3 rounded-xl border border-sky-100 bg-sky-50 px-4 py-3 text-xs text-sky-800">
      <span class="h-4 w-4 animate-spin rounded-full border border-sky-300 border-t-transparent"></span>
      <span>Cargando productos, por favor espere…</span>
    </div>

    <!-- Error -->
    <div *ngIf="errorMessage"
      class="flex items-start gap-3 rounded-xl border border-red-100 bg-red-50 px-4 py-3 text-xs text-red-800">
      <span class="mt-0.5 h-2 w-2 rounded-full bg-red-400"></span>
      <div>
        <p class="font-semibold">Ocurrió un problema</p>
        <p class="mt-0.5 text-[11px]">{{ errorMessage }}</p>
      </div>
    </div>

    <!-- Contenido principal -->
    <div *ngIf="!isLoading && !errorMessage">

      <!-- Grid de tarjetas -->
      <ng-container *ngIf="products.length; else emptyState">
        <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
          <div *ngFor="let product of products" class="group flex flex-col overflow-hidden rounded-xl border border-slate-200 bg-white 
         shadow-[0_2px_10px_rgba(15,23,42,0.05)]
         transition-transform hover:-translate-y-0.5 hover:shadow-[0_6px_20px_rgba(15,23,42,0.10)]">

            <!-- Imagen más pequeña -->
            <div class="relative h-24 w-full overflow-hidden bg-slate-100">
              <img *ngIf="product.imageUrl; else placeholderImage" [src]="product.imageUrl" [alt]="product.name"
                class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105" />

              <ng-template #placeholderImage>
                <div class="flex h-full w-full items-center justify-center text-[10px] text-slate-400">
                  Sin imagen
                </div>
              </ng-template>

              <!-- Precio sobre la imagen -->
              <div class="absolute bottom-1 right-1 rounded-md bg-emerald-50/90 
             px-2 py-0.5 text-[9px] font-semibold text-emerald-700 shadow-sm">
                {{ product.precio | currency:'COP':'symbol-narrow':'1.0-0' }}
              </div>
            </div>

            <!-- Contenido compacto, sin descripción -->
            <div class="flex flex-1 flex-col px-2.5 py-1.5">

              <!-- Nombre -->
              <h3 class="line-clamp-2 text-[11px] font-semibold text-slate-900 leading-snug">
                {{ product.nombre }}
              </h3>

              <!-- Precio + botón -->
              <div class="mt-1 flex items-end justify-between">
                <div class="flex flex-col">
                  <span class="text-[8px] uppercase tracking-[0.12em] text-slate-400">
                    Precio
                  </span>
                  <span class="text-[11px] font-semibold text-emerald-700">
                    {{ product.precio | currency:'COP':'symbol-narrow':'1.0-0' }}
                  </span>
                </div>

                <button
                  class="inline-flex items-center gap-1.5 rounded-full bg-gradient-to-r from-sky-500 to-indigo-600 
               px-2.5 py-1 text-[9px] font-medium text-white shadow-sm 
               hover:from-sky-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-sky-300 focus:ring-offset-1"
                  (click)="goToDetail(product)">
                  <span>Ver detalle</span>
                  <span class="text-[10px]">›</span>
                </button>
              </div>

            </div>
          </div>

        </div>

        <!-- Paginación -->
        <div class="mt-4 flex flex-col gap-2 items-center justify-between text-xs text-slate-600 sm:flex-row"
          *ngIf="totalItems > pageSize">
          <div class="flex items-center gap-2">
            <span class="h-1.5 w-1.5 rounded-full bg-sky-400"></span>
            <span>
              Mostrando
              <strong>{{ (page ) * pageSize + 1 }}</strong>
              –
              <strong>
                {{ (page * pageSize) > totalItems ? totalItems : (page * pageSize)+1 }}
              </strong>
              de <strong>{{ totalItems }}</strong> productos
            </span>
          </div>

          <div class="inline-flex items-center rounded-full border border-slate-200 bg-white shadow-sm overflow-hidden">
            <button
              class="px-3 py-1.5 text-[11px] font-medium text-slate-600 hover:bg-slate-50 disabled:opacity-40 disabled:hover:bg-white disabled:cursor-not-allowed"
              [disabled]="page === 0" (click)="onPageChange(page - 1)">
              Anterior
            </button>

            <span class="border-x border-slate-200 px-4 py-1.5 text-[11px] font-semibold text-slate-800 bg-slate-50">
              Página {{ page }}
            </span>

            <button
              class="px-3 py-1.5 text-[11px] font-medium text-slate-600 hover:bg-slate-50 disabled:opacity-40 disabled:hover:bg-white disabled:cursor-not-allowed"
              [disabled]="page * pageSize >= totalItems" (click)="onPageChange(page + 1)">
              Siguiente
            </button>
          </div>
        </div>
      </ng-container>

      <!-- Estado vacío -->
      <ng-template #emptyState>
        <div class="rounded-2xl border border-dashed border-slate-300 bg-slate-50 px-5 py-7 text-center">
          <p class="text-sm font-medium text-slate-700">
            No hay productos para mostrar.
          </p>
          <p class="mt-1 text-[11px] text-slate-500">
            Una vez se registren productos en el sistema, aparecerán aquí en formato de tarjetas.
          </p>
        </div>
      </ng-template>

    </div>
  </div>
</div>